From: Mathieu Trudel-Lapierre <mathieu.trudel-lapierre@canonical.com>
Subject: Only unmanage devices starting with the "veth*" prefix.

Those should only be the host-side veth peer.

---
 src/devices/nm-device-ethernet.c |    7 ++++---
 src/devices/nm-device-veth.c     |    1 -
 2 files changed, 4 insertions(+), 4 deletions(-)

Index: b/src/devices/nm-device-veth.c
===================================================================
--- a/src/devices/nm-device-veth.c
+++ b/src/devices/nm-device-veth.c
@@ -111,7 +111,6 @@ nm_device_veth_new (NMPlatformLink *plat
 static void
 nm_device_veth_init (NMDeviceVeth *self)
 {
-	nm_device_set_initial_unmanaged_flag (NM_DEVICE (self), NM_UNMANAGED_DEFAULT, TRUE);
 }
 
 static void
Index: b/src/devices/nm-device-ethernet.c
===================================================================
--- a/src/devices/nm-device-ethernet.c
+++ b/src/devices/nm-device-ethernet.c
@@ -266,7 +266,7 @@ out:
 }
 
 static void
-nm_device_check_virtual (NMDeviceEthernet *self)
+nm_device_check_virtual (NMDeviceEthernet *self, NMLinkType link_type)
 {
 	GUdevDevice *dev = NULL;
 	GUdevClient *client = NULL;
@@ -291,7 +291,8 @@ nm_device_check_virtual (NMDeviceEtherne
 
 	sysfs_path = g_udev_device_get_sysfs_path (dev);
 
-	if (g_ascii_strncasecmp (sysfs_path, virtual, strlen (virtual)) == 0) {
+	if (g_ascii_strncasecmp (sysfs_path, virtual, strlen (virtual)) == 0
+	    && (link_type != NM_LINK_TYPE_VETH || g_str_has_prefix (iface, "veth"))) {
 		nm_log_info (LOGD_DEVICE | LOGD_HW, "(%s): device is virtual, marking as unmanaged", iface);
 		nm_device_set_initial_unmanaged_flag (NM_DEVICE (self), NM_UNMANAGED_DEFAULT, TRUE);
 	}
@@ -330,7 +331,7 @@ constructor (GType type,
 		/* s390 stuff */
 		_update_s390_subchannels (NM_DEVICE_ETHERNET (self));
 
-		nm_device_check_virtual (NM_DEVICE_ETHERNET (self));
+		nm_device_check_virtual (NM_DEVICE_ETHERNET (self), nm_platform_link_get_type (ifindex));
 	}
 
 	return object;
